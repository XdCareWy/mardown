## Q

#####数据后台

1. 后台数据的关系只有新增，没有查看、修改、删除的功能

2. 录入关系的时候，自己可以绑定自己，会有循环引用的问题。

3. 是否能确定哪些模块之间可以录入关系？例如：活动和db录关系，明显不合理，可否能限制一下

##### 可视化

1. 以哪个字段来显示模块的名称？（现在用的serviceName）
2. 如果模块名称过长，怎么处理？（现在采用截取，显示部分）
3. 数据下发问题：在数据后台录入关系relation字段在可视化接口里全是0

















#### 一种基于svg链路监控





#### 链路可视化方案

1. 计算树的最大层数，以及所有层中最大的节点数
2. 根据1中计算的结果，以及默认的宽度和高度，来计算svg画布的高度和宽度
3. 计算每个节点的位置坐标（x, y）
4. 计算重复节点的最远距离







##### 链路监控前端初步工时

1. 后台cms数据录入（猎户座搭建）  1天
2. 链路拓扑可视化设计、渲染数据格式设计  2天
3. 可视化组件开发（目前梳理出来图形：多边形、矩形、椭圆、正方形） 2天  
4. 使用数据、组件来渲染可视化图形  1天
5. http://hmc.jd.com/pageBlock/upsertBlock

旭东，为了减少脏数据的出现，一些字段可以写死或者查询后赋值，（字段：父节点类型：fType,子节点类型：cType)



 对应的值：活动===0；缓存===1；db===2；es===3；接口====4；mq====5；页面====6；



### 设计

##### 数据节点（type标识）

活动、页面、一级接口、二级接口、三级接口、外部接口、数据库、Jimdb缓存

##### 关系：多对多

+ 活动 => 页面、
+ 页面 => 一级接口、 
+ 一级接口 => 二级接口 
+ 二级接口 => 二级接口 
+ 二级接口 => 三级接口
+ 三级接口 => 外部接口
+  三级接口 => 数据库
+ 三级接口 => Jimdb缓存

```json
[
  {
    pid: [1,2,3],
    nodeName: "xxx",
    ...其他表示该节点的字段信息,
    childrenId: [5,6,7]
  },
  {
    pid: [1,2,3],
    nodeName: "xxx",
    ...其他表示该节点的字段信息,
    childrenId: [5,6,7]
  },
  {
    id: 10,
    pid: [1,2,3],
    nodeName: "xxx",
    ...其他表示该节点的字段信息,
    childrenId: [11,12,13]
  },
  {
    id: 11,
    childrenId: []
  }
]
```

```json
{
  pid: [0_1,2,3],
  nodeName: "xxx",
  ...其他表示该节点的字段信息，
  children: [
  	{
			pid: [1,2,3],
      nodeName: "xxx",
      ...其他表示该节点的字段信息，
      children: [
        {

        }
      ]
    },
  	{
			pid: [1,2,3],
      nodeName: "xxx",
      ...其他表示该节点的字段信息，
      children: [
        {

        }
      ]
    },
  	{
			pid: [1,2,3],
      nodeName: "xxx",
      ...其他表示该节点的字段信息，
      children: [
        {

        }
      ]
    },
  ]
}
```



```json
class Node

id
children List<Node> List<int>
pid: List<>

List<Node> id必须唯一
Node
{
  "parents": [
    {
      "id": 1,
      "relation": 2,
      "seq": 1,
      "cache": 0,
      "cacheType": 0,
      "specialMark": 0,
      "fid": 1,
      "sid": 2,
      "ftype": "0",
      "ctype": "0"
    },
    {
      "id": 3,
      "type": "b"
    }
  ]
  "id": 1,
  ....,
  "children": [
    {
      "id": 2,
      "type": "a"
    },
    {
      "id": 3,
      "type": "b"
    }
  ]
}

```







##### 节点的数据结构

| 字段名      | 描述               | 类型  | 备注           |
| ----------- | :----------------- | ----- | -------------- |
| f_id        | 上一级id           | Array |                |
| s_id        | 当前id             |       |                |
| system_name | 系统名称           |       |                |
| app_name    | 应用名称           |       |                |
| type        | 节点的类型         |       | 这个节点很重要 |
| 。。。      | 以后需要新增的节点 |       |                |
| childNodes  | 子节点             | Array |                |

###### Type枚举

```ts
enum {
  活动、页面、一级接口、二级接口、三级接口、外部接口、数据库、Jimdb缓存
}
```

##### 可视化效果

![image2020-2-12_10-12-49.png](https://img13.360buyimg.com/imagetools/jfs/t1/102371/26/12503/88585/5e4ca3feEe2841b1a/5bf5ef512bdedb33.png)



##### 里程碑（猎户座可视化集成、链路监控、Flutter状态管理调研）

猎户座

| 计划名               | 开始时间   | 结束时间   | 工时(天) | 输出                         |
| -------------------- | ---------- | ---------- | -------- | ---------------------------- |
| 原有逻辑配置代码熟悉 | 2020.02.20 | 2020.02.21 | 2        | 找到与逻辑相关的代码         |
| 集成逻辑展示及配置   | 2020.02.24 | 2020.02.25 | 2        | 猎户座中可操作逻辑展示及配置 |
| 引擎解析逻辑         | 2020.02.26 | 2020.02.28 | 3        | 能正常解析逻辑表达式         |
| 展示节点的功能       | 2020.03.02 | 2020.03.04 | 3        | 功能节点配置及展示           |



链路监控

| 计划名             | 开始时间   | 结束时间   | 工时(天) | 输出                         |
| ------------------ | ---------- | ---------- | -------- | ---------------------------- |
| 基本图形组件封装   | 2020.03.05 | 2020.03.06 | 2        | 椭圆、正方形、长方形、多边形 |
| 根据数据组装图形   | 2020.03.09 | 2020.03.13 | 5        | 正常渲染图形                 |
| 数据解析、数据转换 | 2020.03.16 | 2020.03.18 | 3        | 数据可正常转化为能渲染的数据 |
| 图形布局及连线     | 2020.03.19 | 2020.03.25 | 5        | 可视化布局                   |



flutter状态管理调研

| 状态管理     | 开始时间   | 结束时间   | 工时(天) | 输出                                                         |
| ------------ | ---------- | ---------- | -------- | ------------------------------------------------------------ |
| Redux        | 2020.02.14 | 2020.02.17 | 2        | 1. 集成Redux的计数器DEMO<br />2. Redux的集成文档             |
| Scoped Modal | 2020.03.09 | 2020.03.10 | 2        | 1. 集成Scoped Modal的计数器DEMO<br />2. Scoped Modal的集成文档 |
| RxDart       | 2020.03.11 | 2020.03.13 | 3        | 1. 集成RxDart的计数器DEMO<br />2. RxDart的集成文档           |
| BLoC         | 2020.03.16 | 2020.03.18 | 3        | 1. 集成BLoC的计数器DEMO<br />2. BLoC的集成文档               |
| Provide      | 2020.03.19 | 2020.03.20 | 3        | 1. 集成Provide的计数器DEMO<br />2. Provide的集成文档         |

















